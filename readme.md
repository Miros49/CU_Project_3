# Документация по веб-сервису прогноза погоды (Flask)

Этот веб-сервис, реализованный на Flask, предоставляет прогноз погоды для маршрутов между двумя городами и отдельными городами. Сервис обращается к внешнему API для получения погодных данных по названиям городов и их координатам. Вместе с приложением также запускается телеграм-бот, который предоставляет удобный интерфейс для доступа к прогнозу погоды. Инструкции по использованию доступны в самом боте.

## Эндпоинты

### 1. `GET /` - Проверка погоды на маршруте

Этот эндпоинт отображает главную страницу, где пользователи могут ввести два города (начальный и конечный) для проверки прогноза погоды по маршруту.

- **Методы**: `GET`, `POST`
- **Параметры запроса** (POST):
  - `start_city`: Название начального города.
  - `end_city`: Название конечного города.

- **Ответ**:
  - При валидных городах отображается шаблон `route_weather_results.html` с данными:
    - `start_city`: Название начального города.
    - `end_city`: Название конечного города.
    - `start_condition`: Погодные условия начальной точки (хорошие/неблагоприятные).
    - `end_condition`: Погодные условия конечной точки (хорошие/неблагоприятные).

- **Обработка ошибок**:
  - При невозможности получения координат или данных о погоде выводится сообщение об ошибке и происходит возврат на форму.
  - Пример сообщения: `"Не удалось найти координаты для указанных городов."`

### 2. `POST /check_route_weather` - AJAX Проверка погоды на маршруте

Этот эндпоинт проверяет погодные условия на маршруте между двумя городами через AJAX и возвращает данные в формате JSON.

- **Метод**: `POST`
- **Тело запроса** (JSON):
  - `start_city`: Название начального города.
  - `end_city`: Название конечного города.

- **Ответ**:
  - JSON объект, содержащий:
    - `start_city`: Название начального города.
    - `start_weather_condition`: Погодные условия начальной точки (хорошие/неблагоприятные).
    - `end_city`: Название конечного города.
    - `end_weather_condition`: Погодные условия конечной точки (хорошие/неблагоприятные).

- **Обработка ошибок**:
  - 400, если оба города не указаны.
  - 500, если не удалось получить координаты или данные о погоде.

### 3. `GET /get_weather` - Прогноз погоды для города

Этот эндпоинт предоставляет прогноз погоды и текущую температуру для конкретного города.

- **Метод**: `GET`
- **Параметры запроса**:
  - `city`: Название города для прогноза (по умолчанию: `Москва`).
  - `days`: Количество дней прогноза (по умолчанию: 5).
  - `day_index`: Индекс дня в прогнозе, чтобы переключаться между днями прогноза.

- **Ответ**:
  - Отображается шаблон `get_weather.html`, содержащий:
    - `city`: Название города.
    - `current_temperature`: Текущая температура в градусах Цельсия.
    - `temperature_max`: Максимальная температура за указанный день.
    - `temperature_min`: Минимальная температура за указанный день.
    - `real_feel`: Ощущаемая температура.
    - `wind_speed`: Скорость ветра.
    - `precipitation_probability`: Вероятность осадков.
    - `precipitation_type`: Тип осадков (например, дождь или снег).
    - `icon_phrase`: Описание погодных условий.
    - `sunrise` и `sunset`: Время восхода и заката солнца.
    - `date`: Дата прогноза в формате `дд.мм.гггг`.
    
- **Обработка ошибок**:
  - 500, если не удалось получить координаты, ключ местоположения или данные о погоде.
  - Пример ошибки: `{"error": "Не удалось получить текущие данные о погоде."}`

## Ключевые вспомогательные функции

### `get_coordinates_by_city(city_name)`
Получает координаты города на основе его названия.

### `get_location_key(lat, lon)`
Возвращает ключ местоположения для города по его широте и долготе.

### `get_weather_by_location(lat, lon, days)`
Получает прогноз погоды на основе координат и количества дней прогноза.

### `get_current_weather(location_key)`
Возвращает текущие данные о погоде по ключу местоположения.

### `translate_weather(icon_phrase)`
Переводит погодные описания на русский язык.

### `check_bad_weather(temp, wind_speed, precip_prob, precip_intensity)`
Анализирует погодные условия (температура, скорость ветра и вероятность осадков) для определения их "хорошести" или "неблагоприятности".

## Обработка ошибок и сообщения

Сервис включает обработку ошибок HTTP-статусов 404, 500, 503 и т.д. Пользователям отображаются информативные сообщения о проблемах в работе сервиса с соответствующим визуальным оформлением.

## Телеграм-бот

Вместе с приложением запускается Телеграм-бот, предоставляющий пользователям возможность получить прогноз погоды через удобный интерфейс в мессенджере. Инструкции по работе с ботом доступны в самом приложении.
